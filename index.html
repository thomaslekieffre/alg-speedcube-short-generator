<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Twisty Export - G√©n√©rateur de vid√©os</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: system-ui, -apple-system, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 2rem;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      h1 {
        color: #333;
        margin-bottom: 0.5rem;
        font-size: 2rem;
      }
      .subtitle {
        color: #666;
        margin-bottom: 2rem;
        font-size: 0.95rem;
      }
      .form-grid {
        display: grid;
        gap: 1.5rem;
        margin-bottom: 2rem;
      }
      .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      label {
        font-weight: 600;
        color: #333;
        font-size: 0.9rem;
      }
      .label-desc {
        font-size: 0.8rem;
        color: #666;
        font-weight: 400;
      }
      input,
      select,
      textarea {
        padding: 0.75rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-family: inherit;
        font-size: 0.95rem;
        transition: border-color 0.2s;
      }
      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
      }
      textarea {
        font-family: "Courier New", monospace;
        min-height: 80px;
        resize: vertical;
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }
      .row.three-cols {
        grid-template-columns: 1fr 1fr 1fr;
      }
      .color-input-wrapper {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }
      input[type="color"] {
        width: 60px;
        height: 42px;
        padding: 2px;
        cursor: pointer;
      }
      input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: #667eea;
      }
      .btn {
        padding: 1rem 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
      }
      .btn:active {
        transform: translateY(0);
      }
      .command-box {
        background: #1a1b1e;
        color: #00ff00;
        padding: 1.5rem;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 0.85rem;
        overflow-x: auto;
        margin-top: 1.5rem;
        display: none;
        position: relative;
      }
      .command-box.show {
        display: block;
      }
      .command-title {
        color: #888;
        font-size: 0.75rem;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .command-text {
        user-select: all;
        word-break: break-all;
      }
      .copy-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        padding: 0.5rem 1rem;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: background 0.2s;
      }
      .copy-btn:hover {
        background: #764ba2;
      }
      .preview {
        margin-top: 2rem;
        padding: 1.5rem;
        background: #f5f5f5;
        border-radius: 8px;
        text-align: center;
      }
      .preview h3 {
        color: #333;
        margin-bottom: 1rem;
      }
      twisty-player {
        width: 300px;
        height: 300px;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üé¨ Twisty Export</h1>
      <p class="subtitle">
        G√©n√©rateur de vid√©os de cubes Rubik - Configurez et g√©n√©rez votre
        commande d'export
      </p>

      <div class="form-grid">
        <div class="form-group">
          <label>
            Algorithme
            <span class="label-desc">(notation standard du cube)</span>
          </label>
          <textarea id="alg" placeholder="R U R' U' M' U R U' R' M">
R U R' U' M' U R U' R' M</textarea
          >
        </div>

        <div class="row">
          <div class="form-group">
            <label>
              Nom
              <span class="label-desc">(affich√© en haut)</span>
            </label>
            <input type="text" id="name" placeholder="OLL 57" value="OLL 57" />
          </div>

          <div class="form-group">
            <label>
              Notation
              <span class="label-desc">(affich√©e en bas)</span>
            </label>
            <input
              type="text"
              id="notation"
              placeholder="Laisser vide = algo"
            />
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            <label>
              Puzzle
              <span class="label-desc">(type de cube)</span>
            </label>
            <select id="puzzle">
              <option value="3x3x3">3x3x3</option>
              <option value="2x2x2">2x2x2</option>
              <option value="4x4x4">4x4x4</option>
              <option value="5x5x5">5x5x5</option>
              <option value="pyraminx">Pyraminx</option>
              <option value="megaminx">Megaminx</option>
              <option value="skewb">Skewb</option>
            </select>
          </div>

          <div class="form-group">
            <label>
              Couleur de fond
              <span class="label-desc">(al√©atoire si vide)</span>
            </label>
            <div class="color-input-wrapper">
              <input type="color" id="bgColor" value="#ff6b6b" />
              <input type="text" id="bgHex" value="#ff6b6b" />
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>
            Vitesses d'animation
            <span class="label-desc">(multiplie la vitesse normale)</span>
          </label>
          <div class="row three-cols">
            <div>
              <input
                type="number"
                id="speed1"
                step="0.1"
                min="0.1"
                max="10"
                value="1.5"
                placeholder="1√®re lecture"
              />
              <div style="font-size: 0.75rem; color: #666; margin-top: 0.25rem">
                1√®re lecture
              </div>
            </div>
            <div>
              <input
                type="number"
                id="speedSetup"
                step="0.1"
                min="0.1"
                max="10"
                value="3.0"
                placeholder="Setup/reverse"
              />
              <div style="font-size: 0.75rem; color: #666; margin-top: 0.25rem">
                Setup (reverse)
              </div>
            </div>
            <div>
              <input
                type="number"
                id="speed2"
                step="0.1"
                min="0.1"
                max="10"
                value="1.0"
                placeholder="2√®me lecture"
              />
              <div style="font-size: 0.75rem; color: #666; margin-top: 0.25rem">
                2√®me lecture
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>
            Fichier de sortie
            <span class="label-desc">(chemin relatif)</span>
          </label>
          <input
            type="text"
            id="output"
            placeholder="out/ma_video.mp4"
            value="out/OLL_57.mp4"
          />
        </div>

        <div class="form-group">
          <label>
            Effets et transitions
            <span class="label-desc">(personnalise l'animation)</span>
          </label>
          <div
            style="
              display: flex;
              flex-wrap: wrap;
              gap: 1rem;
              margin-top: 0.5rem;
            "
          >
            <label
              style="
                display: flex;
                align-items: center;
                gap: 0.5rem;
                cursor: pointer;
                font-weight: 400;
                color: #333;
              "
            >
              <input type="checkbox" id="showFlash" checked />
              <span>‚ú® Flash entre phases</span>
            </label>
            <label
              style="
                display: flex;
                align-items: center;
                gap: 0.5rem;
                cursor: pointer;
                font-weight: 400;
                color: #333;
              "
            >
              <input type="checkbox" id="showGlow" checked />
              <span>üí´ Glow sur SETUP</span>
            </label>
            <label
              style="
                display: flex;
                align-items: center;
                gap: 0.5rem;
                cursor: pointer;
                font-weight: 400;
                color: #333;
              "
            >
              <input type="checkbox" id="showSpeed" checked />
              <span>‚ö° Indicateur vitesse</span>
            </label>
            <label
              style="
                display: flex;
                align-items: center;
                gap: 0.5rem;
                cursor: pointer;
                font-weight: 400;
                color: #333;
              "
            >
              <input type="checkbox" id="showMoves" checked />
              <span>üìä Compteur mouvements</span>
            </label>
          </div>
        </div>
      </div>

      <button class="btn" id="generateBtn">üöÄ G√©n√©rer la commande</button>

      <div class="command-box" id="commandBox">
        <div class="command-title">Commande d'export</div>
        <button class="copy-btn" id="copyBtn">üìã Copier</button>
        <div class="command-text" id="commandText"></div>
      </div>

      <div class="preview">
        <h3>Aper√ßu du cube</h3>
        <twisty-player id="preview"></twisty-player>
      </div>
    </div>

    <script type="module">
      import "https://cdn.cubing.net/v0/js/cubing/twisty";

      const els = {
        alg: document.getElementById("alg"),
        name: document.getElementById("name"),
        notation: document.getElementById("notation"),
        puzzle: document.getElementById("puzzle"),
        bgColor: document.getElementById("bgColor"),
        bgHex: document.getElementById("bgHex"),
        speed1: document.getElementById("speed1"),
        speedSetup: document.getElementById("speedSetup"),
        speed2: document.getElementById("speed2"),
        output: document.getElementById("output"),
        showFlash: document.getElementById("showFlash"),
        showGlow: document.getElementById("showGlow"),
        showSpeed: document.getElementById("showSpeed"),
        showMoves: document.getElementById("showMoves"),
        generateBtn: document.getElementById("generateBtn"),
        commandBox: document.getElementById("commandBox"),
        commandText: document.getElementById("commandText"),
        copyBtn: document.getElementById("copyBtn"),
        preview: document.getElementById("preview"),
      };

      // Sync color picker et hex input
      els.bgColor.addEventListener("input", () => {
        els.bgHex.value = els.bgColor.value;
      });
      els.bgHex.addEventListener("input", () => {
        if (/^#[0-9A-Fa-f]{6}$/.test(els.bgHex.value)) {
          els.bgColor.value = els.bgHex.value;
        }
      });

      // Update preview
      function updatePreview() {
        const alg = els.alg.value.trim();
        if (!alg) return;

        els.preview.alg = alg;
        els.preview.puzzle = els.puzzle.value;
        els.preview.visualization = "3D";
        els.preview.background = "none";
        els.preview.controlPanel = "bottom-row";
      }

      // Generate command
      function generateCommand() {
        const alg = els.alg.value.trim();
        const name = els.name.value.trim();
        const notation = els.notation.value.trim() || alg;
        const puzzle = els.puzzle.value;
        const bg = els.bgHex.value;
        const speed1 = els.speed1.value;
        const speedSetup = els.speedSetup.value;
        const speed2 = els.speed2.value;
        const output = els.output.value.trim() || "out/export.mp4";
        const showFlash = els.showFlash.checked ? "1" : "0";
        const showGlow = els.showGlow.checked ? "1" : "0";
        const showSpeed = els.showSpeed.checked ? "1" : "0";
        const showMoves = els.showMoves.checked ? "1" : "0";

        if (!alg) {
          alert("L'algorithme est requis !");
          return;
        }

        const cmd = `npm run export -- --alg="${alg}" --name="${name}" --notation="${notation}" --puzzle="${puzzle}" --bg="${bg}" --speed1=${speed1} --speedSetup=${speedSetup} --speed2=${speed2} --showFlash=${showFlash} --showGlow=${showGlow} --showSpeed=${showSpeed} --showMoves=${showMoves} --out="${output}"`;

        els.commandText.textContent = cmd;
        els.commandBox.classList.add("show");

        // Auto scroll to command
        els.commandBox.scrollIntoView({ behavior: "smooth", block: "nearest" });
      }

      // Copy command
      function copyCommand() {
        const text = els.commandText.textContent;
        navigator.clipboard.writeText(text).then(() => {
          const originalText = els.copyBtn.textContent;
          els.copyBtn.textContent = "‚úÖ Copi√© !";
          setTimeout(() => {
            els.copyBtn.textContent = originalText;
          }, 2000);
        });
      }

      // Event listeners
      els.generateBtn.addEventListener("click", generateCommand);
      els.copyBtn.addEventListener("click", copyCommand);
      els.alg.addEventListener("input", updatePreview);
      els.puzzle.addEventListener("change", updatePreview);

      // Auto-update output filename based on name
      els.name.addEventListener("input", () => {
        const name = els.name.value.trim();
        if (name) {
          const safeName = name.replace(/[^a-zA-Z0-9]/g, "_");
          els.output.value = `out/${safeName}.mp4`;
        }
      });

      // Initial preview
      updatePreview();
    </script>
  </body>
</html>
